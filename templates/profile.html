{% include "_header.html" %}
{% include "_nav.html" %}

<main id="profile">
  <h1>Profile</h1>

  <h2>Personal info</h2>
  <ul>
    <li><strong>Username:</strong> {{ user.user_username }}</li>
    <li><strong>Name:</strong> {{ user.user_name }} {{ user.user_last_name }}</li>
    <li><strong>Email:</strong> {{ user.user_email }}</li>
    <li><strong>Member since:</strong> {{ user.user_created_at }}</li>
  </ul>

  <p>
    <a href="{{ url_for('edit_profile') }}">Edit profile</a> |
    <a href="{{ url_for('delete_profile') }}">Delete profile</a>
  </p>

  <!-- Fejlbeskeder eller succes -->
  <div id="form-errors">
    {% if errors %}
      <ul class="error-list">
        {% for field, message in errors.items() %}
          <li>{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}
    {% if success %}
      <p class="success-msg">{{ success }}</p>
    {% endif %}
  </div>

  <h2>Upload a spot</h2>
  <!-- Upload-formular -->
  <form id="item-form" mix-post="/item" enctype="multipart/form-data">
    <input name="item_name" type="text" placeholder="Name"
           value="{{ form.item_name if form else '' }}"
           class="{% if errors and errors.get('item_name') %}input-error{% endif %}" required>

    <textarea name="item_description" placeholder="Description" required
              class="{% if errors and errors.get('item_description') %}input-error{% endif %}">{{ form.item_description if form else '' }}</textarea>

    <input name="item_price" type="number" placeholder="Price"
           value="{{ form.item_price if form else '' }}"
           class="{% if errors and errors.get('item_price') %}input-error{% endif %}" required>

    <input name="item_address" type="text" placeholder="Address"
           value="{{ form.item_address if form else '' }}"
           class="{% if errors and errors.get('item_address') %}input-error{% endif %}" required>

    <input name="item_lat" type="text" placeholder="Latitude"
           value="{{ form.item_lat if form else '' }}"
           class="{% if errors and errors.get('item_lat') %}input-error{% endif %}" required>

    <input name="item_lon" type="text" placeholder="Longitude"
           value="{{ form.item_lon if form else '' }}"
           class="{% if errors and errors.get('item_lon') %}input-error{% endif %}" required>

    <input name="files" type="file" multiple>

    <button>Upload skate spot</button>
  </form>

  <h2>Your spots</h2>
    <!-- Dine items -->
    <section id="items">
          {% for item in items %}
      <div class="item-card" id="x{{ item.item_pk }}">
        <!-- Spot info (stadig synlig selv nÃ¥r edit er skjult) -->
        <h3>{{ item.item_name }}</h3>
        <p><strong>Price:</strong> {{ item.item_price }} DKK</p>
        <p><strong>Address:</strong> {{ item.item_address }}</p>
        <p>{{ item.item_description }}</p>

        <!-- Knapper -->
        <button onclick="toggleEditForm('{{ item.item_pk }}')" type="button">Edit</button>
        <button mix-delete="/items/{{ item.item_pk }}">Delete item</button>

        <!-- Redigeringsform (skjult som standard) -->
        <div class="edit-form-wrapper mix-hidden" id="edit-form-{{ item.item_pk }}">
          <form mix-patch="/items/{{ item.item_pk }}" class="edit-item-form">
            <input type="text" name="item_name" value="{{ item.item_name }}" required>
            <textarea name="item_description" required>{{ item.item_description }}</textarea>
            <input type="number" name="item_price" value="{{ item.item_price }}" required>
            <input type="text" name="item_address" value="{{ item.item_address }}" required>
            <input type="text" name="item_lat" value="{{ item.item_lat }}" required>
            <input type="text" name="item_lon" value="{{ item.item_lon }}" required>

            <button>Save changes</button>
            <button type="button" onclick="toggleEditForm('{{ item.item_pk }}')">Cancel</button>

            <div id="form-errors-{{ item.item_pk }}"></div>
          </form>
        </div>

        <!-- Billeder -->
        <div class="item-images">
          {% for img in item.images %}
            <div id="x{{ img.image_pk }}">
              <img class="uploaded_imgs_profile" src="/static/uploads/{{ img.image_name }}" alt="{{ img.image_name }}">
              <button mix-delete="/images/{{ img.image_pk }}">Delete image</button>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </section>
</main>

<script src="{{ url_for('static', filename='profile.js') }}"></script>

{% include "_footer_base.html" %}